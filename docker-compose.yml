version: '3.8'

services:
  flask:
    # The name of the service is 'flask'
    build:
      context: .  # This refers to the current directory, where your Dockerfile is located
      dockerfile: Dockerfile  # You can specify a different Dockerfile name if necessary
    container_name: flask_app  # Name of the running container
    environment:
      - FLASK_APP=app  # Environment variable that tells Flask where the app is
    volumes:
      - ./app:/app  # Mount the app directory to the container, this allows live code updates
      - ./data:/data  # Mount the data folder to the container (ensure data persists)
      - ./environment.yml:/app/environment.yml  # Optional: Mount the environment.yml if you want to modify it directly
    ports:
      - "5000:5000"  # Expose Flask app on port 5000
    command: ["conda", "run", "-n", "pcd", "python", "-m", "flask", "run", "--host=0.0.0.0", "--port=5000"]
    stdin_open: true  # Allow interaction with the container
    tty: true  # Keep the container running interactively for development
    depends_on:
      - flask_db  # If you have a database service, you can define it here as a dependency (optional)

  flask_db:
    image: postgres:latest  # Example for adding a PostgreSQL database service
    container_name: flask_db
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: flaskdb
    ports:
      - "5432:5432"  # Expose the PostgreSQL port
    volumes:
      - flask_db_data:/var/lib/postgresql/data  # Store data persistently

volumes:
  flask_db_data:  # This is for persistent storage of your database data
