<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>3D Defect Viewer - DLP Advisor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.1.1/model-viewer.min.js"></script>

    <style>
        body {
            background-color: #0f172a;
            color: white;
            overflow: hidden;
            height: 100vh;
        }

        .sidebar {
            background-color: #1e293b;
            height: 100vh;
            overflow-y: auto;
            border-left: 1px solid #334155;
        }

        .defect-card {
            background-color: #334155;
            border: 1px solid #475569;
            transition: all 0.2s;
        }

        .defect-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        .header-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            pointer-events: none;
        }

        .header-content {
            pointer-events: auto;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(5px);
            border-bottom: 1px solid #334155;
        }
    </style>
</head>

<body>

    <div class="header-overlay">
        <div class="header-content d-flex justify-content-between align-items-center px-4 py-3">
            <div class="d-flex align-items-center">
                <h5 class="fw-bold mb-0"><i class="bi bi-buildings-fill me-2 text-primary"></i>DLP Advisor</h5>
            </div>

            <span class="badge bg-primary px-3 py-2 rounded-pill">
                <i class="bi bi-box-seam me-1"></i> Project: {{ project_name }}
            </span>

            <div class="d-flex align-items-center gap-3">
                <div class="vr text-secondary"></div>
                <div class="d-flex align-items-center">
                    <div class="text-end me-2 lh-1">
                        <div class="fw-bold" style="font-size: 13px;">User Console</div>
                        <small class="text-white-50" style="font-size: 10px;">Viewer Mode</small>
                    </div>
                    <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center text-white fw-bold small"
                        style="width: 32px; height: 32px;">
                        <i class="bi bi-person-fill"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid p-0">
        <div class="row g-0">

            <div class="col-lg-9 position-relative" style="height: 100vh; background-color: #020617;">
                <model-viewer src="{{ url_for('static', filename='uploads/' + filename) }}" alt="House Model"
                    auto-rotate camera-controls shadow-intensity="1" style="width: 100%; height: 100%; outline: none;"
                    camera-orbit="45deg 55deg 10m" field-of-view="30deg">

                    <button class="hotspot bg-danger rounded-circle border-0" slot="hotspot-1" data-position="1m 2m 0m"
                        data-normal="1m 0m 0m" style="width: 15px; height: 15px;"></button>
                    <button class="hotspot bg-warning rounded-circle border-0" slot="hotspot-2"
                        data-position="-1m 2.5m 1m" data-normal="0m 1m 0m" style="width: 15px; height: 15px;"></button>
                </model-viewer>
            </div>

            <div class="col-lg-3 sidebar d-flex flex-column p-4">
                <div style="margin-top: 60px;">
                    <h6 class="text-white-50 text-uppercase fw-bold mb-3" style="font-size: 12px;">Defect List</h6>

                    <div class="card defect-card mb-3 text-white">
                        <div class="card-body p-2">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-danger small fw-bold"><i
                                        class="bi bi-exclamation-circle-fill me-1"></i> Wall Crack #1</span>
                            </div>
                            <img src="{{ url_for('static', filename='uploads/leak_01.jpg') }}"
                                class="img-fluid rounded mb-2" alt="Defect">

                            <a href="http://127.0.0.1:5002/?defect=Wall%20Crack&severity=High" target="_blank"
                                class="btn btn-sm btn-info w-100 mb-2 text-white fw-bold">
                                <i class="bi bi-robot me-1"></i> Ask Legal AI
                            </a>
                            <button class="btn btn-sm btn-outline-light w-100" style="font-size: 12px;">View
                                Details</button>
                        </div>
                    </div>

                    <div class="card defect-card mb-3 text-white">
                        <div class="card-body p-2">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-warning small fw-bold"><i class="bi bi-droplet-fill me-1"></i> Leak
                                    #2</span>
                            </div>
                            <div class="text-white-50 small mb-2">Ceiling - Corner</div>
                            <button class="btn btn-sm btn-outline-light w-100" style="font-size: 12px;">View
                                Details</button>
                        </div>
                    </div>
                </div>

                <div class="mt-auto">
                    <a href="{{ back_url }}" class="btn btn-secondary w-100 py-2 fw-bold">
                        <i class="bi bi-arrow-left me-2"></i> Exit Viewer
                    </a>
                </div>
            </div>

        </div>
    </div>

</body>

</html>